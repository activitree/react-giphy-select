{"version":3,"sources":["../../../src/components/GiphySelect/index.js"],"names":["GiphySelect","props","state","items","loadNextPage","bind","_onQueryChange","_fetchItems","_updateItems","_theme","select","styles","selectInput","attribution","theme","_query","_requestTimer","_offset","_totalCount","_activeFetch","e","query","target","value","trim","clearTimeout","setTimeout","setState","requestDelay","requestKey","requestLang","requestRating","endpoint","encodeURIComponent","offset","fetch","then","response","json","catch","console","error","prevState","data","pagination","count","total_count","placeholder","renderEntry","onEntrySelect","Component","defaultProps","GiphyList","propTypes","PropTypes","shape","string","number","func"],"mappings":"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","sourcesContent":["import 'isomorphic-fetch'\nimport React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport GiphyList from '../GiphyList'\nimport styles from './styles.css'\n\nexport default class GiphySelect extends Component {\n  constructor (props) {\n    super(props)\n    this.state = {\n      items: []\n    }\n    this.loadNextPage = this.loadNextPage.bind(this)\n    this._onQueryChange = this._onQueryChange.bind(this)\n    this._fetchItems = this._fetchItems.bind(this)\n    this._updateItems = this._updateItems.bind(this)\n    this._theme = {\n      select: styles.select,\n      selectInput: styles.selectInput,\n      attribution: styles.attribution,\n      ...this.props.theme,\n    }\n    this._query = ''\n    this._requestTimer = null\n    this._offset = 0\n    this._totalCount = 0\n    this._activeFetch = false\n  }\n\n  componentDidMount () {\n    this._fetchItems()\n  }\n\n  // shouldComponentUpdate = () => !this._activeFetch\n\n  loadNextPage () {\n    if (this._offset < this._totalCount) {\n      this._fetchItems()\n    }\n  }\n\n  _onQueryChange (e) {\n    const query = e.target.value.trim()\n\n    if (this._requestTimer) {\n      clearTimeout(this._requestTimer)\n      this._requestTimer = null\n    }\n\n    this._requestTimer = setTimeout(() => {\n      if (query !== this._query) {\n        this._query = query\n        this._offset = 0\n        this._activeFetch = true\n        this.setState({\n          items: [],\n        })\n        this._fetchItems()\n      }\n    }, this.props.requestDelay)\n  }\n\n  _fetchItems () {\n    const { requestKey, requestLang, requestRating } = this.props\n    let endpoint = ''\n    if (this._query) {\n      endpoint = `search?q=${encodeURIComponent(this._query)}&`\n    } else {\n      endpoint = 'trending?'\n    }\n    const offset = this._offset\n\n    fetch(`https://api.giphy.com/v1/gifs/${endpoint}offset=${offset}&lang=${requestLang}&rating=${requestRating}&api_key=${requestKey}`)\n      .then(response => response.json())\n      .then(this._updateItems)\n      .catch(console.error) // eslint-disable-line no-console\n  }\n\n  _updateItems (response) {\n    this._activeFetch = false\n    this.setState(prevState => ({\n      items: [...prevState.items, ...response.data],\n    }))\n    this._offset = response.pagination.offset + response.pagination.count\n    this._totalCount = response.pagination.total_count\n  }\n\n  render() {\n    const { placeholder, renderEntry, onEntrySelect } = this.props\n    const theme = this._theme\n    return (\n      <div className={theme.select}>\n        <input className={theme.selectInput} placeholder={placeholder} onChange={this._onQueryChange} />\n        <GiphyList\n          theme={theme}\n          items={this.state.items}\n          renderEntry={renderEntry}\n          onEntrySelect={onEntrySelect}\n          loadNextPage={this.loadNextPage} />\n        <div className={theme.attribution}>Powered by Giphy</div>\n      </div>\n    )\n  }\n}\n\nGiphySelect.defaultProps = {\n  theme: {},\n  placeholder: 'Search GIFs',\n  requestDelay: 500,\n  requestKey: 'dc6zaTOxFJmzC',\n  requestLang: '',\n  requestRating: 'pg',\n  renderEntry: GiphyList.defaultProps.renderEntry,\n  onEntrySelect: GiphyList.defaultProps.onEntrySelect,\n}\n\nGiphySelect.propTypes = {\n  theme: PropTypes.shape({\n    select: PropTypes.string,\n    selectInput: PropTypes.string,\n    attribution: PropTypes.string,\n  }),\n  placeholder: PropTypes.string,\n  requestDelay: PropTypes.number,\n  requestKey: PropTypes.string,\n  requestLang: PropTypes.string,\n  requestRating: PropTypes.string,\n  renderEntry: PropTypes.func,\n  onEntrySelect: PropTypes.func,\n}\n"],"file":"index.js"}